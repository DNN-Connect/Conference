@inherits ConferenceWebPage<Conference>
@using Connect.DNN.Modules.Conference.Common;
@using Connect.Conference.Core.Models.Conferences;
@using Connect.Conference.Core.Models.Sessions;
@using Connect.Conference.Core.Repositories;
@{
    ConferenceModuleContext.AddBootstrapCss();
    ConferenceModuleContext.AddModuleService();
}

<h2>@Model.Name</h2>

<table class="table">
 <thead>
  <tr>
   <th>@Dnn.LocalizeString("Theme")</th>
   <th>@Dnn.LocalizeString("Sessions")</th>
   <th>@Dnn.LocalizeString("Votes")</th>
   <th></th>
  </tr>
 </thead>
 <tbody>
  @foreach (var t in TagRepository.Instance.GetTagsWithVote(Model.ConferenceId, Dnn.User.UserID).OrderByDescending(t => t.NrVotes))
  {
  <tr>
   <td>@t.TagName</td>
   <td class="nrcol">@t.NrSessions</td>
   <td class="nrcol">@t.NrVotes</td>
   <td class="btncol">
    <a href="#" class="cmdVote btn @(t.Voted > 0 ? "btn-primary" : "btn-default")" data-tag="@t.TagId">
     <span class="glyphicon glyphicon-thumbs-up"></span>
    </a>
   </td>
  </tr>
  }
 </tbody>
</table>

<script type="text/javascript">
 $(function () {

  $(document).ready(function() {

   var service = new ConferenceService($, @Dnn.ModuleContext.ModuleId);
   $('.cmdVote').click(function(e) {
    e.preventDefault();
    var el = $(this);
    var tagId = el.data('tag');
    if (el.hasClass('btn-primary')) {
     service.tagVote(@Model.ConferenceId, tagId, 0, function() {
      el.toggleClass('btn-primary');
     });
    } else {
     service.tagVote(@Model.ConferenceId, tagId, 1, function() {
      el.toggleClass('btn-primary');
     });
    }
    return false;
   });


  });

 });
</script>